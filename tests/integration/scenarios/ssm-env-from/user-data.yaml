disable-services:
  - chrony
  - ssh
env-from:
  # Single value with explicit name
  - ssm:
      path: /app/secrets/api-token
      name: API_TOKEN
  # JSON map expanded to multiple env vars
  - ssm:
      path: /app/config/redis
command:
  - /bin/sh
  - -c
  - |
    exec >/dev/ttyS0 2>&1
    echo "=== ssm-env-from test ==="

    # Check single value env var
    if [ "$API_TOKEN" != "ssm-token-abc123" ]; then
        echo "FAIL: API_TOKEN has wrong value: $API_TOKEN"
        exit 1
    fi
    echo "API_TOKEN verified"

    # Check JSON map env vars
    if [ "$REDIS_HOST" != "redis.local" ]; then
        echo "FAIL: REDIS_HOST has wrong value: $REDIS_HOST"
        exit 1
    fi
    if [ "$REDIS_PORT" != "6379" ]; then
        echo "FAIL: REDIS_PORT has wrong value: $REDIS_PORT"
        exit 1
    fi
    if [ "$REDIS_DB" != "0" ]; then
        echo "FAIL: REDIS_DB has wrong value: $REDIS_DB"
        exit 1
    fi
    echo "REDIS_* env vars verified"

    echo "PASS"
